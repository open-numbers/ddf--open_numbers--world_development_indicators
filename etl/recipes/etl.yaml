info: 
    id: ddf--gapminder--world_development_indicators
    base: 
        - &wdi open-numbers/ddf--world_bank--world_development_indicators
        - &geo open-numbers/ddf--gapminder--geo_entity_domain

config:
    # the path to search recipe files to include
    recipes_dir: ./
    # the path to search dictionary files
    dictionary_dir: ./translation_dictionaries

ingredients:
    - 
        id: wdi-datapoints
        dataset: *wdi
        key: country, year
    - 
        id: wdi-concepts-discrete
        dataset: *wdi
        key: concept
        filter:
            concept_type:
                $nin: 
                    - measure
            concept:
                $nin: 
                    - country         # we will use country from geo domain
    -
        id: wdi-concepts-continuous
        dataset: *wdi
        key: concept
        filter:
            concept_type:
                $in: 
                    - measure
    - 
        id: wdi-countries
        dataset: *wdi
        key: country
    -
        id: gw-countries
        dataset: *geo
        key: geo       
    -
        id: gw-geo-concepts
        dataset: *geo
        key: concept 

cooking:
    concepts:
        -
            procedure: serve
            ingredients:
                - wdi-concepts-continuous
            options:
                file_name: ddf--concepts--continuous.csv
        - 
            procedure: translate_column
            ingredients:
                - wdi-concepts-discrete
            options:
                column: concept
                dictionary:
                    year: time
                not_found: include
            result: wdi-concepts-discrete-translated
        -
            procedure: merge
            ingredients:
                - gw-geo-concepts
                - wdi-concepts-discrete-translated
            options:
                deep: true
            result: wdi-concepts-discrete-final
        -
            procedure: serve
            ingredients:
                - wdi-concepts-discrete-final
            options:
                file_name: ddf--concepts--discrete.csv

    datapoints:
        - 
            procedure: translate_column
            ingredients:
                - wdi-countries
            options:
                column: table_name
                target_column: country_new
                dictionary:
                    base: gw-countries
                    key: ['gapminder_list', 'alternative_1', 'alternative_2', 'alternative_3',
                          'alternative_4_cdiac', 'pandg', 'god_id', 'alt_5', 'upper_case_name',
                          'arb1', 'arb2', 'arb3', 'arb4', 'arb5', 'arb6', 'name', 'iso3166_1_alpha2',
                          'iso3166_1_alpha3', 'iso3166_2']
                    value: geo
            result: wdi-countries-aligned
        - 
            procedure: translate_column
            ingredients:
                - wdi-datapoints
            options:
                column: country
                dictionary:
                    base: wdi-countries-aligned
                    key: country
                    value: country_new
            result: wdi-datapoints-aligned
        - 
            procedure: translate_header
            ingredients:
                - wdi-datapoints-aligned
            options:
                dictionary:
                    country: geo
                    year: time
            result: wdi-datapoints-final
    entities:
        -
            procedure: serve
            ingredients:
                - gw-countries